# Análise de Logs
## Análise de Logs Like a Pro

Iremos aprender a analisar logs pois precisamos desenvolver a habilidade de analisar um log e entender a lógica por trás e entender o que acontece do outro lado quando utilizamos uma ferramenta.

![](images/Pasted%20image%2020240109184133.png)

Para isso iremos baixar esses logs disponibilizados pelo curso:

```bash
wget www.businesscorp.com.br/access.log
```

E podemos abrir utilizando o cat:

```bash
cat access.log
```

Podemos ver a primeira linha utilizando:

```bash
head -n1 access.log
```

![](images/Pasted%20image%2020240109184453.png)

Aqui podemos ver:
- IP: 182.118.53.93
- Data e hora: 08/Feb/2015:08:10:21
- Requisição: GET / HTTP/1.1
- Retorno: 200
- User agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10 10 1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2251.0 Safari/537.36

Para podermos ver apenas o IP, podemos utilizar:

```bash
cat access.log | cut -d " " -f 1 #O separador foi definido como espaço em branco " "
```

E para não mostrar o mesmo IP repetido, podemos utilizar:

```bash
cat access.log | cut -d " " -f 1 | sort -u
```

![](images/Pasted%20image%2020240109185049.png)

Porém assim fica difícil saber quem que foi o atacante, para isso, podemos alterar a nossa busca:

```bash
cat access.log | cut -d " " -f 1 | sort | uniq -c | sort -un
```

![](images/Pasted%20image%2020240109185400.png)

Assim podemos ver quantas requisições tiveram para cada IP. Assim podemos ver que o IP do suspeito claramente é o **177.138.28.7**.

Agora podemos filtrar nossas pesquisas apenas por esse IP:

```bash
cat access.log | grep "177.138.28.7"
```

Porém como são 37.038 logs, podemos ver o primeiro para ver o horário em que o ataque começou:

```bash
cat access.log | grep "177.138.28.7" | head -n1
```

E podemos ver quando que foi a última requisição desse IP:

```bash
cat access.log | grep "177.138.28.7" | tail -n1
```

![](images/Pasted%20image%2020240109185759.png)

Assim podemos deduzir que o ataque durou de  00:21 até 08:58.

Agora para termos certeza de que isso foi um ataque, podemos analisar, por exemplo, as primeiras 500 linhas:

```bash
cat access.log | grep "177.138.28.7" | head -n500
```

E podemos ver que tiveram várias requisições no mesmo horário, no mesmo segundo. Outro ponto é que podemos ver que está sendo utilizado um **nmap** como user agent:

![](images/Pasted%20image%2020240109190205.png)

Podemos filtrar a busca pela ferramenta também para descobrir quais foram as ferramentas utilizadas e quando foram.

Para ver as requisições do nosso atacante, podemos utilizar:

```bash
cat access.log | grep "177.138.28.7" | cut -d '"' -f2 #Separador é aspas duplas "
```

![](images/Pasted%20image%2020240109190532.png)

Assim podemos ver o que o atacante está atacando e se é uma ferramenta ou não com base nas requisições.

Podemos ver também apenas as respostas, para ver quais requisições passaram ou foram redirecionadas:

```bash
cat access.log | grep "177.138.28.7" | cut -d "]" -f2 | grep "301"
```

![](images/Pasted%20image%2020240109190911.png)

