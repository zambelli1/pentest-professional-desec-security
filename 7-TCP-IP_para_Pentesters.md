# TCP/IP para Pentesters

## Introdução as Redes TCP/IP

![](images/Pasted%20image%2020240109192345.png)

![](images/Pasted%20image%2020240109192738.png)

![](images/Pasted%20image%2020240109192912.png)

![](images/Pasted%20image%2020240109193057.png)

![](images/Pasted%20image%2020240109193311.png)

![](images/Pasted%20image%2020240109193540.png)

![](images/Pasted%20image%2020240109193845.png)

![](images/Pasted%20image%2020240109193902.png)

![](images/Pasted%20image%2020240109194055.png)

## Introdução as Redes TCP/IP (Prática)

Aqui iremos ver tudo que vimos anteriormente, porém de forma prática.

Podemos ver os endereços do nosso host:

```bash
ifconfig eth0
```

Aqui podemos ver:
- Endereço lógico (IP Address): 
- Mascara de Rede: 255.255.255.0
- Endereço físico (MAC Address): 00:0c:29:76:43:e1

![](images/Pasted%20image%2020240110211745.png)

Nesse momento essa máquina é um cliente, pois não está prestando serviço para as outras máquinas nessa rede. A partir do momento que subirmos um servidor Apache por exemplo, passa a ser um servidor.

```bash
service apache2 start #Inicia servidor apache
netstat -nlpt | grep 80 #Filtrar a busca na rede pela porta 80
```

Assim podemos ver nosso serviço iniciado na porta 80:

![](images/Pasted%20image%2020240110212222.png)

Podemos ver que a porta 80 foi aberta por padrão, podemos ver os números das portas padrões no Linux com:

```bash
cat /etc/services | more
```

![](images/Pasted%20image%2020240110212411.png)

Tudo pode ser modificado, tanto as portas padrões quanto os endereços IP e MAC. Para alterar o endereço MAC por exemplo, podemos utilizar:

```bash
macchanger -r eth0
```

![](images/Pasted%20image%2020240110212622.png)

Para voltar para o MAC padrão podemos utilizar:

```bash
macchanger -p eth0
```

E para alterar manualmente:

```bash
macchanger -m 00:11:22:33:44:55 eth0
```

Outra coisa mencionada anteriormente foi sobre rotas, que para acessarmos redes diferentes precisamos de roteamento, esse roteamento é feito pelo **gateway**.

Para vermos nosso Gateway, podemos digitar:

```bash
route -n
```

![](images/Pasted%20image%2020240110213109.png)

Com ele, podemos acessar a internet e redes externas. Ele pega nosso pacote da rede interna e leva para a rede externa.

Se deletarmos o nosso gateway:

```bash
route del default gw 192.168.0.1
```

E tentarmos acessar alguma página na internet, podemos ver que não temos mais rota e não conseguimos nos conectar.

![](images/Pasted%20image%2020240110213259.png)

Para adicionarmos novamente nosso gateway:

```bash
route add default gw 192.168.0.1
```

Se quisermos ver detalhes sobre as classes de IP, podemos utilizar:

```bash
ipcalc 192.168.0.200/255.255.255.0 #Seu IP e sua mascara de rede
```

![](images/Pasted%20image%2020240110213529.png)

## Protocolos de Redes

![](images/Pasted%20image%2020240110213712.png)

![](images/Pasted%20image%2020240110213813.png)

![](images/Pasted%20image%2020240110213846.png)

![](images/Pasted%20image%2020240110214047.png)

![](images/Pasted%20image%2020240110214152.png)

## Analisadores de Protocolos

Analisadores de protocolos são ferramentas que nos permitem ver tudo o que está acontecendo no tráfego de rede.

Uma delas é o Wireshark:

![](images/Pasted%20image%2020240111224921.png)

Outra que usamos muito e que faz a mesma coisa porém em linha de comando é o TCPdump:

![](images/Pasted%20image%2020240111225007.png)

![](images/Pasted%20image%2020240111225109.png)

No Wireshark ficaria:

![](images/Pasted%20image%2020240111225206.png)

## Protocolo Ethernet

O protocolo Ethernet entende endereços físicos apenas, logo o que ele carregará no header dele são os MAC address.

![](images/Pasted%20image%2020240111225350.png)

![](images/Pasted%20image%2020240111225447.png)

No Wireshark, podemos ver que o protocolo Ethernet segue essa estrutura:
- Destino
- Origem
- Tipo
- Payload
- Checksum

![](images/Pasted%20image%2020240111225641.png)

![](images/Pasted%20image%2020240111225722.png)

## Protocolo ARP

![](images/Pasted%20image%2020240111225923.png)

Para entender a importância do protocolo ARP, vamos utilizar um comando:

```bash
arp -an
```

Em nossa máquina servidor, podemos ver a tabela ARP com o endereço do roteador e o endereço físico do roteador:

![](images/Pasted%20image%2020240111230136.png)

Se entrarmos em uma máquina cliente e acessarmos o Web Server

![](images/Pasted%20image%2020240111230406.png)

Se olharmos novamente a tabela ARP, podemos ver que agora ele tem o endereço da máquina cliente. 

![](images/Pasted%20image%2020240111230508.png)

Isso aconteceu pois quando acessamos o servidor Web,  pedimos o recurso para o servidor,  para o servidor responder, ele precisa conhecer o endereço físico e como ele não conhecia, ele disparou um ARP Request para toda a rede procurando pelo IP e a máquina que possuí respondeu com um ARP Reply passando o seu endereço físico.
## Estrutura do Protocolo ARP

