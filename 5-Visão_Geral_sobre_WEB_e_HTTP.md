# Visão geral sobre WEB e HTTP

## Overview sobre Web / HTTP

Iremos fazer um overview sobre WEB e HTTP que são conceitos fundamentais para quem deseja atuar como Pentester e entender como funciona, entender o lado do servidor e cliente.

![](images/Pasted%20image%2020240107170032.png)

![](images/Pasted%20image%2020240107170115.png)

![](images/Pasted%20image%2020240107170147.png)

![](images/Pasted%20image%2020240107170210.png)

## Entendendo o lado do servidor

### Exemplo 1

No Kali Linux temos um servidor apache, que já vimos antes como abrir:

```bash
service apache2 start
```

Podemos acessar nossa página pelo nosso IP no Firefox, que nesse caso, seria o cliente.

Podemos ir no diretório raiz do apache:

```bash
cd /var/www/html/
```

E se olharmos, teremos um arquivo **index.html**:

![](images/Pasted%20image%2020240108215359.png)

Podemos copiar nosso **index.html** para manter o backup:

```bash
mv index.html original.html
```

Agora que não temos mais um arquivo **index.html** (mudou para original.html), ao acessarmos nossa página, será exibido:

![](images/Pasted%20image%2020240108215624.png)

No caso será exibido tudo que tem dentro do diretório. Isso por si só é uma falha de segurança pois o atacante pode navegar de forma livre pelos arquivos dentro desse diretório.

Correção:

Podemos ir para as configurações do apache:

```bash
nano /etc/apache2/apache2.conf
```

Descer até encontrar essa parte:

![](images/Pasted%20image%2020240108220119.png)

E podemos remover a parte **Indexes** da linha destacada na imagem:

![](images/Pasted%20image%2020240108220217.png)

Agora se reiniciarmos o nosso servidor:

```bash
service apache2 restart
```

Agora se tentarmos listar um diretório existente dentro do nosso servidor irá retornar **403 Forbidden**:

![](images/Pasted%20image%2020240108220340.png)

Se digitarmos um diretório não existente, irá nos retornar **404 Not Found**:

![](images/Pasted%20image%2020240108220537.png)

Porém note que mesmo assim, nas duas vezes ele nos retornou o banner do apache, com algumas configurações e informações.

Correção:

Para isso iremos em outro arquivo de configuração:

```bash
nano /etc/apache2/conf-enabled/security.conf
```

E podemos ver a configuração atual e qual o nível que ela está:

![](images/Pasted%20image%2020240108220910.png)

No caso está como '**OS**', o máximo seria o '**Full**', logo iremos utilizar o mínimo '**Prod**':

![](images/Pasted%20image%2020240108221010.png)

Agora se reiniciarmos o apache novamente e olharmos nossa página, podemos ver que algumas informações foram ocultadas:

![](images/Pasted%20image%2020240108221112.png)

Para ocular ainda mais, podemos procurar no arquivo de segurança pela seguinte linha:

![](images/Pasted%20image%2020240108221250.png)

E alterar para '**Off**':

![](images/Pasted%20image%2020240108221325.png)

Agora se reiniciarmos o servidor, não irá mais exibir nenhuma informação:

![](images/Pasted%20image%2020240108221356.png)

Agora o atacante não consegue saber mais se o servidor é um apache e em qual sistema ele está hospedado.

### Exemplo 2

Agora iremos subir um web server em Python:

```bash
python -m SimpleHttpServer 8080
```

Se acessarmos essa página, podemos ver a listagem de diretórios de onde ele foi iniciado (no caso Desktop):

![](images/Pasted%20image%2020240108221650.png)

Se criarmos um arquivo **index.html** e ligarmos novamente o nosso servidor, ele irá abrir no arquivo criado:

![](images/Pasted%20image%2020240108221835.png)

E se tentarmos uma requisição inválida, podemos perceber que ele se comporta de forma parecida, nos dando um código de erro:

![](images/Pasted%20image%2020240108221914.png)

### Exemplo 3

Continuando do lado do servidor, iremos analisar os logs do servidor:

```bash
cd /var/log/apache2/
```

Dentro desse diretório tem um arquivo de log chamado **access.log**. Se abrirmos o final desse arquivo para monitorar os últimos logs em tempo real:

```bash
tail -f access.log
```

Agora tudo que acontecer de requisição no servidor, nós iremos ver nos logs. Ao tentarmos acessar o diretório '**/curso**':

![](images/Pasted%20image%2020240108222329.png)

Porém podemos ver no final dos nossos logs que foi gerado um log com:
- IP: 192.168.0.200 
- Data e hora: 28/Aug/2019:23:19:42
- Requisição: GET /curso HTTP/1.1
- Retorno: 404
- User agent: Mozilla/5.0 (X11; Linux x86 64; rv:60.0) Gecko/20100101 Firefox/60.0

![](images/Pasted%20image%2020240108222502.png)

Se no servidor tiver bem configurado ou um firewall, podemos bloquear user agents como scanners, que ao tentar realizar um scan, seria bloqueado. Ao entender essa base, fica mais fácil de entender o que você está fazendo e porque trocar o user agent.

## Entendendo o lado do cliente

Aqui iremos entender o lado do cliente. Podemos abrir o navegador e acessar um site, no caso da aula, businesscorp.com.br.

Mas como que acontece o lado do cliente, apenas acessamos a página e o browser já nos trouxe a página. Se clicarmos com o botão direito do mouse, podemos ver o código fonte da página, ao digitarmos uma requisição inválida, iremos ver os erros aprendidos nas aulas anteriores.

Para fazer a conexão iremos utilizar o **netcat**:

```bash
nc -v www.businesscorp.com.br 80 #Aqui iremos fazer uma conexão com o servidor na porta 80
```

Logo em seguida, o servidor irá ficar esperando você montar a requisição:

![](images/Pasted%20image%2020240108223810.png)

E podemos montar da seguinte forma:

```bash
GET / HTTP/1.0
```

E após dar 'ENTER' duas vezes, podemos visualizar o código fonte da página:

![](images/Pasted%20image%2020240108223930.png)

Utilizamos o GET que significa que estamos requisitando um serviço do servidor, estamos passando '/' que é a raíz do servidor e fala que estamos nos comunicando através do 'HTTP/1.0'.

Então para entender melhor:

- Primeiro temos o request
- Segundo temos o response
- Terceiro temos o body

![](images/Pasted%20image%2020240108224404.png)

Aqui ele nos exibe o body como texto pois estamos em linha de comando, o nosso navegador sabe interpretar isso e exibe de forma visual.

Ao enviar uma requisição inválida, podemos ver:

![](images/Pasted%20image%2020240108224559.png)

Podemos alterar a requisição, nesse caso, iremos passar um HEAD para ver apenas o header da página:

![](images/Pasted%20image%2020240108224731.png)

Outro método que podemos enviar para o servidor é o **OPTIONS** que nos informa todos os métodos permitidos:

![](images/Pasted%20image%2020240108224914.png)

Podemos fazer nossa requisição direta usando uma das seguintes formas:

```bash
printf "HEAD / HTTP/1.0\r\n\r\n" | nc www.businesscorp.com.br 80
echo -e "HEAD / HTTP/1.0\r\n\r\n" | nc www.businesscorp.com.br 80
```

![](images/Pasted%20image%2020240108225046.png)

Outra ferramenta que podemos utilizar é o **curl**:

```bash
curl -I businesscorp.com.br #Mostra apenas o HEADER
curl -v businesscorp.com.br #Mostra tudo, header (request e response) e body
```

E por último podemos usar um proxy, no caso o BurpSuite, que precisamos configurar no nosso navegador:

- Primeiro iremos abrir o BurpSuite e ir em **Proxy** > **Options** e ver onde ele está escutando (no caso, na porta 8080):

![](images/Pasted%20image%2020240108225727.png)

- Agora podemos ativar o proxy indo em **Proxy** > **Intercept** e selecionar **Intercept is on**:

![](images/Pasted%20image%2020240108225830.png)

- Agora para configurar no navegador, podemos ir em **Edit** > **Preferences**:

![](images/Pasted%20image%2020240108225928.png)

- Podemos pesquisar por **Network** ou **Proxy**:

![](images/Pasted%20image%2020240108230037.png)

- E ao abrir as configurações, podemos informar o endereço que vimos no nosso proxy (Manual proxy > 127.0.0.1 8080 e selecionar Use this proxy server for all protocols):

![](images/Pasted%20image%2020240108230156.png)

Estamos avisando para o nosso navegador que todas as requisições irão passar primeiro por um proxy.

Agora ao tentar fazer uma conexão com um site via navegador, podemos ver que a tela irá ficar congelada, pois ela parou no nosso proxy e lá podemos ver a requisição completa:

![](images/Pasted%20image%2020240108230438.png)

Podemos enviar ela, dropar, alterar, enviar para o Repeater para testar o servidor alterando a requisição, etc.

Por exemplo, ao tentarmos entrar nessa página com um login e senha:

![](images/Pasted%20image%2020240108230615.png)

Podemos ver no nosso proxy a requisição POST com o usuário e a senha, podendo mudar a requisição para ver a resposta do servidor:

![](images/Pasted%20image%2020240108230723.png)

Podemos mandar para o Repeater e ficar modificando e pegando a resposta do servidor:

![](images/Pasted%20image%2020240108230816.png)

